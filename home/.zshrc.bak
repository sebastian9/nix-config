# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Set name of the theme to load --- if set to "random", it will
# load a random theme each time oh-my-zsh is loaded, in which case,
# to know which specific one was loaded, run: echo $RANDOM_THEME
# See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes
# ZSH_THEME="tjkirch"
ZSH_THEME="robbyrussell"

# Set list of themes to pick from when loading at random
# Setting this variable when ZSH_THEME=random will cause zsh to load
# a theme from this variable instead of looking in $ZSH/themes/
# If set to an empty array, this variable will have no effect.
# ZSH_THEME_RANDOM_CANDIDATES=( "robbyrussell" "agnoster" )

# Uncomment the following line to use case-sensitive completion.
# CASE_SENSITIVE="true"

# Uncomment the following line to use hyphen-insensitive completion.
# Case-sensitive completion must be off. _ and - will be interchangeable.
# HYPHEN_INSENSITIVE="true"

# Uncomment one of the following lines to change the auto-update behavior
# zstyle ':omz:update' mode disabled  # disable automatic updates
# zstyle ':omz:update' mode auto      # update automatically without asking
# zstyle ':omz:update' mode reminder  # just remind me to update when it's time

# Uncomment the following line to change how often to auto-update (in days).
# zstyle ':omz:update' frequency 13

# Uncomment the following line if pasting URLs and other text is messed up.
# DISABLE_MAGIC_FUNCTIONS="true"

# Uncomment the following line to disable colors in ls.
# DISABLE_LS_COLORS="true"

# Uncomment the following line to disable auto-setting terminal title.
# DISABLE_AUTO_TITLE="true"

# Uncomment the following line to enable command auto-correction.
# ENABLE_CORRECTION="true"

# Uncomment the following line to display red dots whilst waiting for completion.
# You can also set it to another string to have that shown instead of the default red dots.
# e.g. COMPLETION_WAITING_DOTS="%F{yellow}waiting...%f"
# Caution: this setting can cause issues with multiline prompts in zsh < 5.7.1 (see #5765)
# COMPLETION_WAITING_DOTS="true"

# Uncomment the following line if you want to disable marking untracked files
# under VCS as dirty. This makes repository status check for large repositories
# much, much faster.
# DISABLE_UNTRACKED_FILES_DIRTY="true"


# Would you like to use another custom folder than $ZSH/custom?
# ZSH_CUSTOM=/path/to/new-custom-folder

# Which plugins would you like to load?
# Standard plugins can be found in $ZSH/plugins/
# Custom plugins may be added to $ZSH_CUSTOM/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
# Add wisely, as too many plugins slow down shell startup.
plugins=(git)

source $ZSH/oh-my-zsh.sh



# Compilation flags
# export ARCHFLAGS="-arch x86_64"

# Set personal aliases, overriding those provided by oh-my-zsh libs,
# plugins, and themes. Aliases can be placed here, though oh-my-zsh
# users are encouraged to define aliases within the ZSH_CUSTOM folder.
# For a full list of active aliases, run `alias`.
#

### START ###

alias zshconfig="nvim ~/.zshrc"
export EDITOR="nvim"
alias install_nvim_on_container="~/.config/nvim/install_on_container.sh"

PIPENV_VENV_IN_PROJECT=1 # This will create the virtual environment in the project folder

export PATH="$HOME/.pyenv/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv init -)"

# Add VS Code to path
export PATH="$PATH:/Applications/Visual Studio Code.app/Contents/Resources/app/bin"

# Custom command line tools aliases
# export CLI_TOOLS_PATH="/Users/slopezsanchez/Library/CloudStorage/OneDrive-Tesla/command_line_tools/"
# main_script="${CLI_TOOLS_PATH}bin/main.py"
# pipenv_file="${CLI_TOOLS_PATH}Pipfile"
# run_command="PIPENV_PIPFILE=\"$pipenv_file\" pipenv run python3 "
# run_main="${run_command} \"${main_script}\""
# alias pdfdir="$run_main pdf_folder"
# alias jobdir="$run_main job_folder"
# alias jobsl="$run_main sl_diagram"
# function tiein() {
    # open -a "Firefox" "/Users/slopezsanchez/Library/CloudStorage/OneDrive-Tesla/code/solarapp/diagrams/outputs/$1.svg"
# }
# alias jobcheck="$run_main submit_project"
# alias update_spec="$run_main update_spec"

alias firefox="open -a 'Firefox'"
alias excel="open -a 'Microsoft Excel'"

# Node Version Manager
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

# MOJO
# export MODULAR_HOME="$HOME/.modular"
# export PATH="$MODULAR_HOME/pkg/packages.modular.com_mojo/bin:$PATH"

alias cl="clear"
alias cdcode="cd \"/Users/slopezsanchez/OneDrive - Tesla/code/\""
alias cdspec="cd \"/Users/slopezsanchez/OneDrive - Tesla/code/solarapp/spec\""
alias cdebt="cd \"/Users/slopezsanchez/OneDrive - Tesla/code/tesla/energy-business-tools\""
alias gdl="git diff HEAD^ HEAD"
alias gci="git commit --interactive"
alias wcl="wc -l"

upsert_env () {
  local file_path=$1
  local variable=$(echo "$2" | tr '[:lower:]' '[:upper:]') 
  local value=$3

  echo "Updating or inserting $variable in $file_path..."

  # Check if the variable already exists
  if grep -q "^${variable}=" "$file_path"; then
    # Variable exists, so update it
    echo "Variable $variable found. Updating its value..."
    sed -i "s/^${variable}=.*/${variable}=${value}/" "$file_path"
    echo "Updated $variable with $value."
  else
    # Variable does not exist, so append it
    echo "Variable $variable not found. Adding it to the file..."
    echo "${variable}=${value}" >> "$file_path"
    echo "Appended $variable with $value to $file_path."
  fi
}

delete_env () {
  local file_path=$1
  local variable=$(echo "$2" | tr '[:lower:]' '[:upper:]') 

  echo "Attempting to delete $variable from $file_path..."

  # Check if the variable exists and delete it
  if grep -q "^${variable}=" "$file_path"; then
    # Variable exists; delete its line
    sed -i "/^${variable}=/d" "$file_path"
    echo "Deleted $variable from $file_path."
  else
    # Variable does not exist
    echo "Variable $variable not found. No action taken."
  fi
}

# Usage example: delete_variable .env VARIABLE_NAME


# Usage example: update_or_insert .env VARIABLE_NAME new_value


local solarapp_path="/Users/slopezsanchez/OneDrive - Tesla/code/solarapp"
local spec_json_path="$solarapp_path/spec/SPEC.json"

export SOLARAPP_SPEC_PATH="$solarapp_path/spec"

parse_spec () {
  (cd "$solarapp_path/spec") #&& gcd)
  echo "Parsing SPEC file..."
  (cd "$solarapp_path/utilites" && pipenv run python ./src/sapp_tools/bin/parse_spec.py "$solarapp_path/spec" $1 $2)
  echo "Done parsing SPEC file."
}

replace_spec_aliases () {
  (cd "$solarapp_path/spec") #&& gcd)
  echo "Replacing SPEC aliases..."
  (cd "$solarapp_path/utilites" && pipenv run python ./src/sapp_tools/bin/replace_spec_aliases.py)
  echo "Done replacing SPEC aliases."
}

compile_spec () {
  (cd "$solarapp_path/spec" && gcd)
  (cd "$solarapp_path/utilites" && pipenv run python ./src/sapp_tools/bin/compile_spec.py $spec_json_path ./outputs && excel ./SPEC.xlsx)
  clear
}

spec_version () {
  (cd "$solarapp_path/spec" && gcd && grep -Eo 'v[0-9]+\.[0-9]+\.[0-9]+-[0-9]+' SPEC.json)
}

analytics () {
  (cd "$solarapp_path/utilites" && pipenv run python ./src/sapp_tools/bin/analytics.py)
  clear
}

run_all_regression () {
    (cd "$solarapp_path/solarapp-test" && pipenv run python ./tests/run_parallel_permit_tests.py)
}

config_regression () {
    local variable=$1
    local value=$2
    local target_file=""$solarapp_path/solarapp-test"/tests/.env"
    # if -d flag is passed, delete the variable
    if [ "$value" = "-d" ]; then
        (delete_env  $target_file $variable)
    else
        (upsert_env $target_file $variable $value)
    fi
}

clean_regression () {
    (cd "$solarapp_path/solarapp-test" && rm ./data/regression/current/* && rm ./data/regression/passed/*)
}

# Copy regression test cases from the test case folder in the argument
copy_regression () {
    (cd "$solarapp_path/solarapp-test" && cp "./data/regression/test_cases/$1/*" ./data/regression/current/)
}

quick_stats () {
    clear
    (cd "$solarapp_path/utilites" && pipenv run python ./src/sapp_tools/bin/quick_stats.py > "$HOME/Desktop/quick_stats.txt")
    less "$HOME/Desktop/quick_stats.txt"
    open "$HOME/Desktop"
}

mount_jobs () {
    mount_smbfs smb://teslamotors.com/us/Energy/Jobs/ ~/Energy_Server/jobs
}

mount_cut_sheets () {
    mount_smbfs smb://teslamotors.com/us/Energy/Photon/Engineering/Common/Installs/Drafting/CUTSHEETS/ ~/Energy_Server/cutsheets
}

less_grep () {
  local nth=${2:-1}  # Set default value for nth to 1 if not provided
  local file=$(grep -rl "$1" . | head -n $nth| tail -n 1)  # Search for the pattern in the current directory
  if [ -z "$file" ]; then
    echo "No file found"
  else
    less "$file"
  fi
}

less_failed () {
  local nth=${1:-1}  
  local current_logs_dir="./solarapp-test/data/regression/current"
  (cdcode && cd "$current_logs_dir" && less_grep "^FAILED" $nth)
}
export PATH="/opt/homebrew/opt/openjdk/bin:$PATH"

# Created by `pipx` on 2024-06-25 23:44:05
export PATH="$PATH:/Users/slopezsanchez/.local/bin"

alias nvimrc="nvim ~/.config/nvim/init.lua"

# Key repeat speed
defaults write NSGlobalDomain InitialKeyRepeat -int 15

alias clean_branches='FILE=/tmp/git-unmerged && git branch --no-merged > $FILE && vim $FILE && xargs git branch -d < $FILE'
